<!---->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reefscape Touchscreen Interface</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- This starts the NetworkTables websocket, it can be accessed from multiple
     pages simultaneously -->
    <script src="/networktables/networktables.js"></script>

    <!-- Obviously, you will want to copy this file locally in a real 
         dashboard, as the Driver Station won't have internet access -->
    <script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>

    <!-- uncomment this is you want to use included utility functions that
         implement common functionality that you might find useful. Requires
         that d3.js and jQuery are included first -->
    <!-- <script src="/networktables/utils.js"></script> -->

    <div>
    	NetworkTables websocket: <span id="connectstate">Unknown state</span><br/>
    	Robot: <span id="robotstate">Unknown state</span> @ <span id="robotAddress">disconnected</span>
        btnValue: <span id="btnTest">Unknown</span>
    </div>
    <hr/>

    <!--
    <table id="nt" border=1>
    	<tbody></tbody>
    </table>
    -->

    <!---->   
    <!--<h1>Reefscape Interface</h1>-->
<!---->
    <div class="interface">
        <div id="reef-position" class="reef-container">
            <button id="A" class="button reef-button" onclick="selectReef('A')">A</button>
            <button id="B" class="button reef-button" onclick="selectReef('B')">B</button>
            <button id="C" class="button reef-button" onclick="selectReef('C')">C</button>
            <button id="D" class="button reef-button" onclick="selectReef('D')">D</button>
            <button id="E" class="button reef-button" onclick="selectReef('E')">E</button>
            <button id="F" class="button reef-button" onclick="selectReef('F')">F</button>
            <button id="G" class="button reef-button" onclick="selectReef('G')">G</button>
            <button id="H" class="button reef-button" onclick="selectReef('H')">H</button>
            <button id="I" class="button reef-button" onclick="selectReef('I')">I</button>
            <button id="J" class="button reef-button" onclick="selectReef('J')">J</button>
            <button id="K" class="button reef-button" onclick="selectReef('K')">K</button>
            <button id="L" class="button reef-button" onclick="selectReef('L')">L</button>
        </div>

        <div id="reef-height" class="reef-container">
            <div id="reef-pipe" class="reef-level">
                <button id="L1" class="button level-button" onclick="selectLevel('L1')">L1</button>
                <button id="L2" class="button level-button" onclick="selectLevel('L2')">L2</button>
                <button id="L3" class="button level-button" onclick="selectLevel('L3')">L3</button>
                <button id="L4" class="button level-button" onclick="selectLevel('L4')">L4</button>
            </div>
            <img src="images/reef-pipe.png" alt="reef-pipe" id="img-pipe">
        </div>

    </div>

    <script type="text/javascript">
    "use strict";


    $(document).ready(function(){

// sets a function that will be called when the websocket connects/disconnects
NetworkTables.addWsConnectionListener(onNetworkTablesConnection, true);

// sets a function that will be called when the robot connects/disconnects
NetworkTables.addRobotConnectionListener(onRobotConnection, true);

// sets a function that will be called when any NetworkTables key/value changes
//NetworkTables.addGlobalListener(onValueChanged, true);

NetworkTables.addKeyListener('/SmartDashboard/btnValue', function(key, value, isNew){
// do something with the values as they change
$('#btnTest').text(value?"ligado" : "desligado");
}, true);
});


function onRobotConnection(connected) {
$('#robotstate').text(connected ? "Connected!" : "Disconnected");
$('#robotAddress').text(connected ? NetworkTables.getRobotAddress() : "disconnected");
}

function onNetworkTablesConnection(connected) {

if (connected) {
    $("#connectstate").text("Connected!");
    
    // clear the table
    //$("#nt tbody > tr").remove();
    
} else {
    $("#connectstate").text("Disconnected!");
}
}


/*
function onValueChanged(key, value, isNew) {

// key thing here: we're using the various NetworkTable keys as
// the id of the elements that we're appending, for simplicity. However,
// the key names aren't always valid HTML identifiers, so we use
// the NetworkTables.keyToId() function to convert them appropriately

if (isNew) {
    var tr = $('<tr></tr>').appendTo($('#nt > tbody:last'));
    $('<td></td>').text(key).appendTo(tr);
    $('<td></td>').attr('id', NetworkTables.keyToId(key))
                   .text(value)
                   .appendTo(tr);
} else {

    // similarly, use keySelector to convert the key to a valid jQuery
    // selector. This should work for class names also, not just for ids
    $('#' + NetworkTables.keySelector(key)).text(value);
}
}
//*/


        let previousButtonReef = null;
        let buttonClickedReef = false;
        let previousButtonLevel = null;
        let buttonClickedLevel = false;
        const purple = "#6200ea";
        const green = "#4CAF50";
        const gray = "#a1a4a1";

        function selectReef(position) {
            if(previousButtonReef != null){
                previousButtonReef.style.backgroundColor = gray;
            }
            NetworkTables.putValue('/SmartDashboard/btnValue',true);
            const button = document.getElementById(position);
            button.style.backgroundColor = purple;
            previousButtonReef = button;
            buttonClickedReef = true;

        }

        function selectLevel(level) {
            if(previousButtonLevel != null){
                previousButtonLevel.style.backgroundColor = gray;
            }
            const button = document.getElementById(level);
            button.style.backgroundColor = green;
            previousButtonLevel = button;
            buttonClickedLevel = true;
        }
//*
        document.addEventListener('click', function(event) {
                if (buttonClickedReef && !event.target.classList.contains('level-button') && !event.target.classList.contains('reef-button')) {
                    //alert(previousButtonReef.style.backgroundColor);
                    NetworkTables.putValue('/SmartDashboard/btnValue',false);
                    //*
                    if(previousButtonReef.style.backgroundColor == "rgb(98, 0, 234)"){
                        previousButtonReef.style.backgroundColor = gray;
                        //previousButtonReef = null;
                        buttonClickedReef = false;
                    }
                    //*/

                }

                if (buttonClickedLevel && !event.target.classList.contains('level-button') && !event.target.classList.contains('reef-button')) {
                    //alert(previousButtonLevel.style.backgroundColor);
                    
                    //*
                    if(previousButtonLevel.style.backgroundColor == "rgb(76, 175, 80)"){
                        previousButtonLevel.style.backgroundColor = gray;
                        //previousButtonReef = null;
                        buttonClickedLevel = false;
                    }
                    //*/

                }
            });

    </script>
</body>
</html>
<!---->

